<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot 控制台 - 管理中心</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;500;600;700&family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles/admin.css">
</head>
<body>
    <!-- 呼吸光环 -->
    <div class="breathing-glow"></div>

    <div class="container">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">Bot Agent</div>
                <div class="logo-subtitle">管理中心</div>
            </div>

            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">概览</div>
                    <div class="nav-item active" data-page="dashboard">
                        <span class="nav-icon">📊</span>
                        <span>仪表盘</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">管理</div>
                    <div class="nav-item" data-page="bots">
                        <span class="nav-icon">🤖</span>
                        <span>Bot 管理</span>
                        <span class="badge" id="nav-bots-badge">-</span>
                    </div>
                    <div class="nav-item" data-page="sop">
                        <span class="nav-icon">⏰</span>
                        <span>提醒工作流</span>
                        <span class="badge" id="nav-workflows-badge">-</span>
                    </div>
                    <div class="nav-item" data-page="groups">
                        <span class="nav-icon">👥</span>
                        <span>群聊管理</span>
                        <span class="badge" id="nav-groups-badge">-</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">数据</div>
                    <div class="nav-item" data-page="analytics">
                        <span class="nav-icon">📈</span>
                        <span>数据分析</span>
                    </div>
                    <div class="nav-item" data-page="logs">
                        <span class="nav-icon">📋</span>
                        <span>对话记录</span>
                    </div>
                    <div class="nav-item" data-page="ai-insights">
                        <span class="nav-icon">🧠</span>
                        <span>AI 分析</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">设置</div>
                    <div class="nav-item" data-page="templates">
                        <span class="nav-icon">🎨</span>
                        <span>场景模板</span>
                    </div>
                    <div class="nav-item" data-page="knowledge">
                        <span class="nav-icon">📚</span>
                        <span>知识库</span>
                    </div>
                    <div class="nav-item" data-page="api">
                        <span class="nav-icon">🔌</span>
                        <span>API 接口</span>
                    </div>
                    <div class="nav-item" data-page="settings">
                        <span class="nav-icon">⚙️</span>
                        <span>系统设置</span>
                    </div>
                </div>
            </nav>

            <div class="user-section">
                <div class="user-avatar">👤</div>
                <div class="user-info">
                    <h4>管理员</h4>
                    <p>admin@bot.com</p>
                </div>
            </div>
        </div>

        <!-- 主内容 -->
        <div class="main-content" id="mainContent">
            <!-- 仪表盘页面 -->
            <div id="page-dashboard">
                <div class="page-header">
                    <h1 class="page-title">仪表盘</h1>
                    <p class="page-description">实时监控所有 Bot、提醒和群聊的运行状态 🌟</p>
                </div>

                <!-- 统计卡片 -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon primary">🤖</div>
                            <div class="stat-trend" id="stat-bot-trend">↑ 12%</div>
                        </div>
                        <div class="stat-value" id="stat-bot-count">-</div>
                        <div class="stat-label">活跃 Bot 数量</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon warning">⏰</div>
                            <div class="stat-trend" id="stat-workflow-trend">↑ 8%</div>
                        </div>
                        <div class="stat-value" id="stat-workflow-count">-</div>
                        <div class="stat-label">运行中的提醒</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon success">👥</div>
                            <div class="stat-trend" id="stat-group-trend">↑ 5%</div>
                        </div>
                        <div class="stat-value" id="stat-group-count">-</div>
                        <div class="stat-label">活跃群聊</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon success">💬</div>
                            <div class="stat-trend" id="stat-message-trend">↑ 28%</div>
                        </div>
                        <div class="stat-value" id="stat-message-count">-</div>
                        <div class="stat-label">今日对话次数</div>
                    </div>
                </div>

                <!-- 最近活动 -->
                <div class="section-header">
                    <h2 class="section-title">最近活动</h2>
                </div>

                <div class="execution-log" id="recent-activities">
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">加载中...</div>
                </div>
            </div>

            <!-- 提醒工作流页面 -->
            <div id="page-sop" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">提醒工作流管理</h1>
                    <p class="page-description">配置定时任务和自动化工作流 ⏰</p>
                </div>

                <div class="section-header">
                    <h2 class="section-title">我的工作流</h2>
                    <button class="btn btn-primary">
                        <span>➕</span>
                        <span>创建新提醒</span>
                    </button>
                </div>

                <div class="items-grid" id="sop-tasks-container">
                    <div class="empty" style="padding: 3rem; text-align: center;">
                        <div class="empty-title">加载中...</div>
                        <div class="empty-desc">正在获取工作流实时数据</div>
                    </div>
                </div>
            </div>

            <!-- 群聊管理页面 -->
            <div id="page-groups" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">群聊管理</h1>
                    <p class="page-description">管理多 Bot 协作群组 👥</p>
                </div>

                <div class="section-header">
                    <h2 class="section-title">我的群聊</h2>
                    <button class="btn btn-primary">
                        <span>➕</span>
                        <span>创建新群聊</span>
                    </button>
                </div>

                <div class="items-grid" id="groups-container">
                    <div class="empty" style="padding: 3rem; text-align: center;">
                        <div class="empty-title">加载中...</div>
                        <div class="empty-desc">正在获取群聊实时数据</div>
                    </div>
                </div>
            </div>

            <!-- Bot 管理页面 -->
            <div id="page-bots" style="display: none;">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">机器人管理</h1>
                        <p class="page-description">集中管理机器人配置、状态与发布 🤖</p>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-secondary" id="btn-bots-export">导出</button>
                        <label class="btn btn-secondary" for="bots-import-input" style="cursor: pointer;">导入</label>
                        <input id="bots-import-input" type="file" accept="application/json" style="display: none;" />
                        <button class="btn btn-primary" id="btn-bot-create">
                            <span>➕</span>
                            <span>新建机器人</span>
                        </button>
                    </div>
                </div>

                <div style="background: linear-gradient(145deg, #ffffff, #f8f6f2); box-shadow: var(--shadow-soft); border-radius: var(--radius-lg); padding: var(--space-lg);">
                    <!-- 工具栏 -->
                    <div class="toolbar">
                        <div class="field">
                            <input class="input" id="bots-search" placeholder="搜索：机器人名称 / 负责人 / 备注" style="width: 280px;" />
                        </div>

                        <div class="field">
                            <select class="select" id="bots-filter-status">
                                <option value="">全部状态</option>
                                <option value="online">在线</option>
                                <option value="offline">离线</option>
                                <option value="suspended">暂停</option>
                            </select>
                        </div>

                        <div class="field">
                            <select class="select" id="bots-filter-channel">
                                <option value="">全部场景</option>
                                <option value="work">工作</option>
                                <option value="life">生活</option>
                                <option value="love">情感</option>
                                <option value="group">群聊</option>
                                <option value="sop">SOP</option>
                            </select>
                        </div>

                        <div class="field grow"></div>

                        <div class="field">
                            <span class="muted" id="bots-count">0 个机器人</span>
                        </div>
                    </div>

                    <!-- 表格区域 -->
                    <div class="table-wrap" id="bots-table-wrap">
                        <table class="table" id="bots-table">
                            <thead>
                                <tr>
                                    <th>机器人</th>
                                    <th>场景</th>
                                    <th>状态</th>
                                    <th>最近更新</th>
                                    <th>类型</th>
                                    <th>提示词</th>
                                    <th>工作流</th>
                                    <th style="width: 220px;">操作</th>
                                </tr>
                            </thead>
                            <tbody id="bots-tbody"></tbody>
                        </table>

                        <!-- 空状态 -->
                        <div class="empty" id="bots-empty" style="display: none;">
                            <div class="empty-title">还没有机器人</div>
                            <div class="empty-desc">你可以先新建一个机器人，配置场景和类型后上线。</div>
                            <button class="btn btn-primary" id="btn-bot-create-empty" style="margin-top: var(--space-md);">
                                <span>➕</span>
                                <span>新建机器人</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-analytics" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">数据分析</h1>
                    <p class="page-description">查看近 7 天对话与消息趋势 📈</p>
                </div>
                <div style="background: linear-gradient(145deg, #ffffff, #f8f6f2); box-shadow: var(--shadow-soft); border-radius: var(--radius-lg); padding: var(--space-lg);">
                    <div class="stats-grid" style="margin-bottom: var(--space-lg);">
                        <div class="stat-card"><div class="stat-label">机器人总数</div><div class="stat-value" id="analytics-bots-total">-</div></div>
                        <div class="stat-card"><div class="stat-label">在线机器人</div><div class="stat-value" id="analytics-bots-online">-</div></div>
                        <div class="stat-card"><div class="stat-label">总对话数</div><div class="stat-value" id="analytics-conversations-total">-</div></div>
                        <div class="stat-card"><div class="stat-label">总消息数</div><div class="stat-value" id="analytics-messages-total">-</div></div>
                    </div>
                    <div class="execution-log" id="analytics-trends" style="min-height: 120px;"></div>
                </div>
            </div>

            <div id="page-logs" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">对话记录</h1>
                    <p class="page-description">查看会话与消息历史 📋</p>
                </div>
                <div style="display: grid; gap: var(--space-lg);">
                    <div style="background: #fff; border-radius: var(--radius-lg); box-shadow: var(--shadow-soft); padding: var(--space-lg);">
                        <div style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
                            <select class="select" id="logs-bot-filter" style="min-width: 220px;">
                                <option value="">全部 Bot</option>
                            </select>
                            <input class="input" id="logs-topic-filter" placeholder="按对话主题筛选" style="min-width: 180px;" />
                            <input class="input" id="logs-content-filter" placeholder="按内容关键词筛选" style="min-width: 180px;" />
                            <input class="input" id="logs-start-date" type="date" />
                            <input class="input" id="logs-end-date" type="date" />
                            <button class="btn btn-secondary" id="logs-refresh-btn">刷新记录</button>
                            <button class="btn btn-primary" id="logs-export-csv-btn">导出 CSV</button>
                        </div>
                    </div>
                    <div style="background: #fff; border-radius: var(--radius-lg); box-shadow: var(--shadow-soft); padding: var(--space-lg);">
                        <h3 style="margin-bottom: 12px;">最近会话</h3>
                        <div class="table-wrap">
                            <table class="table"><thead><tr><th>标题</th><th>机器人</th><th>用户</th><th>消息数</th><th>更新时间</th></tr></thead><tbody id="logs-conversations-body"></tbody></table>
                        </div>
                    </div>
                    <div style="background: #fff; border-radius: var(--radius-lg); box-shadow: var(--shadow-soft); padding: var(--space-lg);">
                        <h3 style="margin-bottom: 12px;">最近消息</h3>
                        <div class="table-wrap">
                            <table class="table"><thead><tr><th>发送方</th><th>内容</th><th>会话</th><th>时间</th></tr></thead><tbody id="logs-messages-body"></tbody></table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-ai-insights" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">AI 分析</h1>
                    <p class="page-description">按主题、日期、内容筛选并用模型生成分析报告 🧠</p>
                </div>
                <div style="display: grid; gap: var(--space-lg);">
                    <div style="background: #fff; border-radius: var(--radius-lg); box-shadow: var(--shadow-soft); padding: var(--space-lg);">
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px;">
                            <select class="select" id="ai-bot-filter">
                                <option value="">全部 Bot</option>
                            </select>
                            <input class="input" id="ai-topic-filter" placeholder="主题（会话标题）" />
                            <input class="input" id="ai-content-filter" placeholder="内容关键词" />
                            <input class="input" id="ai-start-date" type="date" />
                            <input class="input" id="ai-end-date" type="date" />
                            <select class="select" id="ai-model-select">
                                <option value="deepseek-ai/DeepSeek-V3.2">DeepSeek V3.2（默认）</option>
                                <option value="deepseek-ai/DeepSeek-R1">DeepSeek R1</option>
                                <option value="Qwen/Qwen2.5-72B-Instruct">Qwen2.5-72B</option>
                            </select>
                        </div>
                        <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                            <label><input type="checkbox" id="ai-knowledge-text" checked /> 文本</label>
                            <label><input type="checkbox" id="ai-knowledge-image" checked /> 图片</label>
                            <label><input type="checkbox" id="ai-knowledge-drawing" checked /> 绘画</label>
                            <label><input type="checkbox" id="ai-knowledge-pdf" checked /> PDF</label>
                        </div>
                        <textarea class="textarea" id="ai-system-prompt" rows="4" style="margin-top: 12px;" placeholder="系统提示词（可选）">你是运营分析助手。请基于给定对话与知识信息，输出中文分析：总体结论、主要主题、风险点、优化建议。</textarea>
                        <textarea class="textarea" id="ai-analysis-prompt" rows="3" style="margin-top: 12px;" placeholder="补充分析要求（可选）"></textarea>
                        <div style="margin-top: 12px;">
                            <button class="btn btn-primary" id="ai-run-analysis-btn">开始 AI 分析</button>
                            <button class="btn btn-secondary" id="ai-export-csv-btn" style="margin-left: 8px;">导出 CSV</button>
                        </div>
                    </div>
                    <div style="background: #fff; border-radius: var(--radius-lg); box-shadow: var(--shadow-soft); padding: var(--space-lg);">
                        <div id="ai-analysis-meta" class="muted"></div>
                        <pre id="ai-analysis-result" style="margin-top: 12px; white-space: pre-wrap; background: #faf8f4; border-radius: 10px; padding: 12px; min-height: 180px;">请先设置筛选条件并点击“开始 AI 分析”</pre>
                    </div>
                </div>
            </div>

            <div id="page-templates" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">场景模板</h1>
                    <p class="page-description">管理系统提示词模板 🎨</p>
                </div>
                <div style="background: #fff; border-radius: var(--radius-lg); box-shadow: var(--shadow-soft); padding: var(--space-lg);">
                    <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                        <input class="input" id="template-name" placeholder="模板名称" />
                        <select class="select" id="template-scene">
                            <option value="work">工作</option>
                            <option value="life">生活</option>
                            <option value="love">情感</option>
                            <option value="group">群聊</option>
                            <option value="sop">SOP</option>
                        </select>
                        <button class="btn btn-primary" id="template-create-btn">新增模板</button>
                    </div>
                    <textarea class="textarea" id="template-content" placeholder="模板内容"></textarea>
                    <div class="table-wrap" style="margin-top: 16px;">
                        <table class="table"><thead><tr><th>名称</th><th>场景</th><th>内容</th><th>更新时间</th><th>操作</th></tr></thead><tbody id="templates-body"></tbody></table>
                    </div>
                </div>
            </div>

            <div id="page-knowledge" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">知识库</h1>
                    <p class="page-description">管理知识文件与状态 📚</p>
                </div>
                <div style="background: #fff; border-radius: var(--radius-lg); box-shadow: var(--shadow-soft); padding: var(--space-lg);">
                    <div class="table-wrap">
                        <table class="table"><thead><tr><th>文件名</th><th>大小</th><th>状态</th><th>分片数</th><th>创建时间</th><th>操作</th></tr></thead><tbody id="knowledge-body"></tbody></table>
                    </div>
                </div>
            </div>

            <div id="page-api" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">API 接口</h1>
                    <p class="page-description">当前可用接口列表 🔌</p>
                </div>
                <div class="execution-log">
                    <div class="log-item"><div class="log-content"><div class="log-title">GET /api/stats/dashboard</div><div class="log-description">仪表盘统计</div></div></div>
                    <div class="log-item"><div class="log-content"><div class="log-title">GET /api/analytics/overview</div><div class="log-description">分析总览</div></div></div>
                    <div class="log-item"><div class="log-content"><div class="log-title">GET /api/logs/conversations</div><div class="log-description">会话日志</div></div></div>
                    <div class="log-item"><div class="log-content"><div class="log-title">GET /api/logs/messages</div><div class="log-description">消息日志</div></div></div>
                    <div class="log-item"><div class="log-content"><div class="log-title">GET /api/templates</div><div class="log-description">模板列表</div></div></div>
                    <div class="log-item"><div class="log-content"><div class="log-title">GET /api/knowledge/files</div><div class="log-description">知识文件</div></div></div>
                    <div class="log-item"><div class="log-content"><div class="log-title">GET/PUT /api/system/settings</div><div class="log-description">系统设置</div></div></div>
                </div>
            </div>

            <div id="page-settings" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">系统设置</h1>
                    <p class="page-description">配置全局参数 ⚙️</p>
                </div>
                <div style="background: #fff; border-radius: var(--radius-lg); box-shadow: var(--shadow-soft); padding: var(--space-lg); display: grid; gap: 12px; max-width: 700px;">
                    <label class="label" for="setting-app-name">应用名称</label>
                    <input class="input" id="setting-app-name" />
                    <label class="label" for="setting-model">默认模型</label>
                    <input class="input" id="setting-model" />
                    <label class="label" for="setting-retention">消息保留天数</label>
                    <input class="input" id="setting-retention" type="number" min="1" max="3650" />
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input id="setting-registration" type="checkbox" />
                        <span>启用注册</span>
                    </label>
                    <div><button class="btn btn-primary" id="settings-save-btn">保存设置</button></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast 容器 -->
    <div class="toast-stack" id="toast-stack"></div>

    <!-- Modal -->
    <div class="modal-mask" id="modal-mask" style="display: none;">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">标题</div>
                <button class="icon-btn" id="modal-close" aria-label="关闭">✕</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer" id="modal-footer"></div>
        </div>
    </div>

    <script src="assets/lib/api-client.js"></script>
    <script src="assets/lib/auth-manager.js"></script>
    <script src="assets/lib/bot-client.js"></script>
    <script src="assets/scripts/admin.js"></script>
    <script src="assets/scripts/groups-module.js"></script>
</body>
</html>
